"""
供應鏈管理系統綜合範例
展示完整的供應鏈優化流程
"""

import os
from datetime import datetime

print("""
╔══════════════════════════════════════════════════════════════════════════════╗
║                      供應鏈管理系統綜合範例                                    ║
║                                                                              ║
║  涵蓋供應鏈管理的核心功能:                                                    ║
║  1. 路線優化 (Route Optimization)                                           ║
║  2. 庫存優化 (Inventory Optimization)                                       ║
║  3. 供應商績效管理 (Supplier Performance)                                   ║
║  4. 需求預測 (Demand Forecasting)                                           ║
╚══════════════════════════════════════════════════════════════════════════════╝
""")

def demo_route_optimization():
    """路線優化示範"""
    print("\n" + "🔵" * 40)
    print("模組 1: 路線優化系統 (完整度: 95%)")
    print("🔵" * 40)

    print("""
🚚 路線優化功能:
   ✓ TSP (旅行商問題) 求解
   ✓ VRP (車輛路線問題) 求解
   ✓ 遺傳算法優化
   ✓ 容量限制考慮
   ✓ Haversine 距離計算

🚀 快速開始:
   cd route-optimization
   pip install -r requirements.txt
   python example_usage.py

💡 核心功能:

1. TSP 求解
   - 遺傳算法
   - 最近鄰算法
   - 2-opt 優化
   - 動態規劃

2. VRP 求解
   - 多車輛規劃
   - 容量限制
   - 時間窗約束
   - 成本最小化

3. 距離計算
   - Haversine 公式
   - 地理座標轉換
   - 距離矩陣生成

4. 視覺化
   - 路線圖繪製
   - 優化過程動畫
   - 統計報表
    """)

    print("\n【示範：配送路線優化】")
    print("""
問題描述:
  配送中心: 台北總部 (25.0330° N, 121.5654° E)
  配送點數量: 10 個客戶
  車輛容量: 100 件
  目標: 最小化總配送距離

客戶列表:
  C1: 新北市板橋區 (需求: 15件)
  C2: 新北市新莊區 (需求: 20件)
  C3: 桃園市中壢區 (需求: 25件)
  C4: 新竹市東區   (需求: 18件)
  C5: 台中市西屯區 (需求: 22件)
  C6: 彰化縣員林市 (需求: 12件)
  C7: 台南市東區   (需求: 16件)
  C8: 高雄市前鎮區 (需求: 19件)
  C9: 屏東縣屏東市 (需求: 14件)
  C10: 宜蘭縣宜蘭市 (需求: 17件)

遺傳算法優化結果:
──────────────────────────────────────
初始解 (隨機):
  路線: Depot → C3 → C1 → C5 → C8 → C2 → C7 → C9 → C4 → C6 → C10 → Depot
  總距離: 1,245 公里

優化後 (100代進化):
  路線: Depot → C1 → C2 → C10 → C3 → C4 → C5 → C6 → C7 → C8 → C9 → Depot
  總距離: 856 公里

改善: -389 公里 (-31.2%)
燃料節省: 約 38.9 公升 (假設 10km/L)
成本節省: 約 $1,167 (假設 $30/L)

VRP 多車輛方案:
──────────────────────────────────────
車輛 1 (容量: 100件):
  路線: Depot → C1(15) → C2(20) → C10(17) → C3(25) → Depot
  總載貨: 77件
  距離: 245 公里

車輛 2 (容量: 100件):
  路線: Depot → C4(18) → C5(22) → C6(12) → Depot
  總載貨: 52件
  距離: 198 公里

車輛 3 (容量: 100件):
  路線: Depot → C7(16) → C8(19) → C9(14) → Depot
  總載貨: 49件
  距離: 156 公里

總距離: 599 公里
車輛數: 3 輛
總成本: $1,797 (假設 $3/km)
──────────────────────────────────────
    """)

    print("\n💻 Python 使用範例:")
    print("""
from backend.main import RouteOptimizer, Location

# 創建配送點
locations = [
    Location("台北總部", 25.0330, 121.5654),
    Location("板橋客戶", 25.0122, 121.4654),
    Location("新莊客戶", 25.0378, 121.4323),
    # ... 更多客戶
]

# TSP 優化
optimizer = RouteOptimizer(locations)
route, distance = optimizer.solve_tsp_genetic(
    population_size=100,
    generations=100,
    mutation_rate=0.01
)

print(f"最佳路線: {route}")
print(f"總距離: {distance:.2f} km")

# VRP 優化
vrp_solution = optimizer.solve_vrp(
    vehicle_capacity=100,
    demands=[15, 20, 25, ...],
    num_vehicles=3
)

for i, vehicle_route in enumerate(vrp_solution, 1):
    print(f"車輛 {i}: {vehicle_route}")
    """)

def demo_inventory_optimization():
    """庫存優化示範"""
    print("\n" + "🟢" * 40)
    print("模組 2: 庫存優化系統 (完整度: 95%)")
    print("🟢" * 40)

    print("""
📦 庫存優化功能:
   ✓ EOQ (經濟訂購量) 計算
   ✓ 安全庫存計算
   ✓ 再訂購點計算
   ✓ ABC 分析
   ✓ 庫存成本優化

🚀 快速開始:
   cd inventory-optimization
   pip install -r requirements.txt
   python example_usage.py

💡 核心功能:

1. EOQ 模型
   - 經濟訂購量計算
   - 最佳訂購頻率
   - 年度訂購成本
   - 持有成本分析

2. 安全庫存
   - 需求變異考慮
   - 前置時間變異
   - 服務水準設定
   - Z-score 計算

3. ABC 分析
   - 庫存價值分類
   - 80-20 法則應用
   - 差異化管理策略

4. 優化報告
   - 成本節省分析
   - 庫存週轉率
   - 服務水準評估
    """)

    print("\n【示範：庫存優化分析】")
    print("""
產品: 筆記型電腦 (型號: LP-001)

當前狀況:
  年需求量: 5,000 台
  單位成本: $20,000
  訂購成本: $5,000/次
  持有成本率: 20%/年
  前置時間: 14 天
  需求標準差: 50 台/天
  目標服務水準: 95%

EOQ 計算:
──────────────────────────────────────
經濟訂購量 (EOQ):
  EOQ = √(2 × D × S / H)
  EOQ = √(2 × 5000 × 5000 / 4000)
  EOQ = 79 台

最佳訂購次數:
  = 年需求 / EOQ
  = 5,000 / 79
  = 63 次/年

平均訂購週期:
  = 365 / 63
  = 5.8 天

總成本分析:
  年度訂購成本: 63 × $5,000 = $315,000
  年度持有成本: (79/2) × $4,000 = $158,000
  總成本: $473,000

與當前方案比較 (每次訂購 100 台):
  當前訂購成本: 50 × $5,000 = $250,000
  當前持有成本: (100/2) × $4,000 = $200,000
  當前總成本: $450,000

  改善空間: $473,000 - $450,000 = -$23,000
  (當前方案更優，因訂購量接近 EOQ)

安全庫存計算:
──────────────────────────────────────
需求變異:
  日需求平均: 5000/365 = 13.7 台
  需求標準差: 50 台/天

前置時間:
  平均: 14 天
  標準差: 2 天 (假設)

Z-score (95% 服務水準): 1.65

安全庫存:
  SS = Z × √(LT × σ_d² + d² × σ_LT²)
  SS = 1.65 × √(14 × 50² + 13.7² × 2²)
  SS = 1.65 × √(35,000 + 750.76)
  SS = 1.65 × 189.1
  SS = 312 台

再訂購點 (ROP):
  ROP = (日需求 × 前置時間) + 安全庫存
  ROP = (13.7 × 14) + 312
  ROP = 192 + 312
  ROP = 504 台

ABC 分析:
──────────────────────────────────────
產品分類  數量  年度用量價值  累積%  類別  管理策略
────────────────────────────────────────────
LP-001   5000   $100,000,000  45%   A級   嚴密控制
TB-002   3000    $45,000,000  65%   A級   嚴密控制
MS-003   8000    $24,000,000  76%   B級   一般控制
KB-004  10000    $15,000,000  83%   B級   一般控制
AC-005  15000    $12,000,000  88%   B級   一般控制
CH-006  20000     $8,000,000  92%   C級   簡單控制
... (C級產品 20 項)

建議:
  A級 (前 20%): 每日監控，嚴格控制
  B級 (中 30%): 每週檢查，定期補貨
  C級 (後 50%): 每月盤點，批量採購
──────────────────────────────────────
    """)

def demo_supplier_performance():
    """供應商績效管理示範"""
    print("\n" + "🟡" * 40)
    print("模組 3: 供應商績效管理 (完整度: 95%)")
    print("🟡" * 40)

    print("""
📊 供應商績效功能:
   ✓ 多維度績效評分
   ✓ 供應商風險評估
   ✓ 績效趨勢分析
   ✓ 供應商排名
   ✓ 資料庫管理

🚀 快速開始:
   cd supplier-performance
   pip install -r requirements.txt
   python example_usage.py

💡 核心功能:

1. 績效評分
   - 品質評分 (0-100)
   - 交期評分 (0-100)
   - 價格評分 (0-100)
   - 服務評分 (0-100)
   - 加權總分計算

2. 風險評估
   - 財務健康度
   - 依賴程度
   - 替代性評估
   - 地理風險

3. 數據分析
   - 趨勢圖表
   - 對比分析
   - 預警機制

4. 決策支援
   - 供應商選擇建議
   - 改善行動計劃
   - 淘汰建議
    """)

    print("\n【示範：供應商績效評估】")
    print("""
評估期間: 2025 Q3 (7月-9月)
評估供應商: 5 家

績效評分表:
──────────────────────────────────────────────────────────────
供應商    品質  交期  價格  服務  總分  等級  風險  建議
──────────────────────────────────────────────────────────────
A科技     95    92    85    90    91.0   A    低   ✓ 優先合作
B電子     88    85    90    86    87.3   A    中   ✓ 持續合作
C工業     78    80    95    75    81.5   B    中   ⚠ 品質改善
D貿易     70    65    88    72    72.8   C    高   ⚠ 密切關注
E材料     60    58    80    65    64.3   D    高   ⛔ 考慮更換
──────────────────────────────────────────────────────────────

評分標準:
  品質 (權重 40%):
    - 不良率 < 0.1%: 100分
    - 不良率 0.1-0.5%: 80-100分
    - 不良率 > 1%: < 60分

  交期 (權重 30%):
    - 準時率 > 95%: 100分
    - 準時率 90-95%: 80-100分
    - 準時率 < 85%: < 60分

  價格 (權重 20%):
    - 相對市場價格競爭力
    - 價格穩定性
    - 付款條件

  服務 (權重 10%):
    - 響應速度
    - 技術支援
    - 彈性配合度

風險評估詳情:

A科技 (低風險):
  ✓ 財務穩健 (上市公司)
  ✓ 多家客戶，依賴度適中
  ✓ 有 2-3 家替代供應商
  ✓ 本地供應，風險低

E材料 (高風險):
  ⚠ 財務狀況不明朗
  ⚠ 高度依賴少數客戶
  ⚠ 缺乏替代供應商
  ⚠ 遠距離供應，物流風險

改善建議:

針對 C工業:
  1. 安排品質改善會議
  2. 要求提供改善計劃
  3. 增加進貨檢驗頻率
  4. 3個月後重新評估

針對 E材料:
  1. 立即尋找替代供應商
  2. 評估轉換成本
  3. 逐步減少訂單量
  4. 6個月內完成更換

供應商排名趨勢:
  Q1: A > B > C > D > E
  Q2: A > B > C > E > D
  Q3: A > B > C > D > E

  A科技 穩定保持第一
  B電子 持續進步
  C工業 波動較大
  D,E材料 持續下滑
──────────────────────────────────────────────────────────────
    """)

def demo_demand_forecasting():
    """需求預測示範"""
    print("\n" + "🟣" * 40)
    print("模組 4: 需求預測系統 (完整度: 95%)")
    print("🟣" * 40)

    print("""
🔮 需求預測功能:
   ✓ Prophet 時間序列預測
   ✓ 季節性分析
   ✓ 異常檢測
   ✓ 預測準確度評估
   ✓ 視覺化呈現

🚀 快速開始:
   cd demand-forecasting
   pip install -r requirements.txt
   python example_usage.py

💡 核心功能:

1. 時間序列預測
   - Facebook Prophet 算法
   - 趨勢分解
   - 季節性識別
   - 節假日效應

2. 預測模型
   - 自動超參數調整
   - 交叉驗證
   - 多步預測
   - 置信區間

3. 準確度評估
   - MAE (平均絕對誤差)
   - MAPE (平均絕對百分比誤差)
   - RMSE (均方根誤差)

4. 異常檢測
   - 統計方法
   - 離群值識別
   - 趨勢突變點
    """)

    print("\n【示範：需求預測分析】")
    print("""
產品: 筆記型電腦
歷史數據: 2023-01 至 2025-10 (34個月)
預測期間: 2025-11 至 2026-01 (3個月)

歷史需求趨勢:
  2023年平均: 380 台/月
  2024年平均: 425 台/月
  2025年平均: 468 台/月 (至10月)

  年增長率: 約 12%

季節性分析:
──────────────────────────────────────
月份    季節因子  說明
──────────────────────────────────────
1月      0.85    農曆新年，需求下降
2月      0.90    企業採購較少
3月      1.10    新學期，需求增加
4月      1.05    企業新年度採購
5月      1.00    正常水準
6月      0.95    暑假前夕
7月      1.15    暑期促銷
8月      1.20    開學季，需求高峰
9月      1.10    持續採購
10月     1.00    正常水準
11月     0.95    年底前觀望
12月     1.25    年底衝業績，需求高峰
──────────────────────────────────────

Prophet 預測結果:
──────────────────────────────────────────────────────
月份      預測值   下界(80%)  上界(80%)  實際需求  誤差%
──────────────────────────────────────────────────────
2025-08   550      495        605        562      -2.1%
2025-09   505      450        560        492      +2.6%
2025-10   460      405        515        478      -3.8%

2025-11   440      385        495        ?        -
2025-12   575      520        630        ?        -
2026-01   392      337        447        ?        -
──────────────────────────────────────────────────────

模型準確度 (基於過去3個月):
  MAE:  18.5 台
  MAPE: 3.8%
  RMSE: 23.2 台

異常檢測:
  ⚠️  2025-03: 需求異常高 (630台，超出預測 +18%)
     原因: 大客戶批量採購

  ⚠️  2025-06: 需求異常低 (305台，低於預測 -22%)
     原因: 新產品延遲發布

趨勢分解:
  長期趨勢: ↗ 穩定增長
  季節性: ⬆⬇ 明顯的月度週期
  節假日效應: 🎄 12月顯著提升

採購建議:
──────────────────────────────────────
月份     預測需求  安全庫存  建議採購  備註
──────────────────────────────────────
11月      440      100       540      正常採購
12月      575      120       695      增加備貨
1月       392       85       477      農曆新年
──────────────────────────────────────

風險提示:
  📊 12月為銷售高峰，建議提前備貨
  📊 1月需求下降，避免過度庫存
  📊 密切關注競品動態，可能影響需求
  📊 考慮經濟環境變化的潛在影響
──────────────────────────────────────
    """)

def demo_integrated_supply_chain():
    """整合供應鏈工作流程"""
    print("\n" + "🌟" * 40)
    print("完整供應鏈管理工作流程整合")
    print("🌟" * 40)

    print("""
🔄 端到端供應鏈管理流程:

【情境】筆記型電腦的完整供應鏈管理

階段 1: 需求規劃 (Demand Forecasting)
   ↓ 收集歷史銷售數據
   ↓ Prophet 模型預測未來需求
   ↓ 識別季節性模式
   ↓ 考慮促銷和節假日影響
   ↓ 生成月度需求預測

   結果: 12月預測需求 575 台

階段 2: 庫存規劃 (Inventory Optimization)
   ↓ 計算經濟訂購量 (EOQ)
   ↓ 確定安全庫存水準
   ↓ 設定再訂購點
   ↓ ABC 分類管理
   ↓ 優化庫存成本

   結果: 建議採購 695 台 (含安全庫存)

階段 3: 供應商選擇 (Supplier Performance)
   ↓ 評估供應商績效
   ↓ 檢視品質、交期、價格
   ↓ 風險評估
   ↓ 選擇最佳供應商
   ↓ 下達採購訂單

   結果: 選擇 A科技 (評分 91.0)

階段 4: 物流配送 (Route Optimization)
   ↓ 收貨後規劃配送路線
   ↓ VRP 多車輛優化
   ↓ 考慮容量和時間限制
   ↓ 最小化配送成本
   ↓ 執行配送計劃

   結果: 3輛車，總距離 599 km

階段 5: 績效監控
   ↓ 追蹤實際需求 vs 預測
   ↓ 監控庫存週轉率
   ↓ 評估供應商表現
   ↓ 分析配送效率
   ↓ 持續改進流程

完整流程時間線:

Week 1: 需求預測與規劃
  Day 1-2: 數據收集與清洗
  Day 3-4: 運行預測模型
  Day 5:   生成採購計劃

Week 2: 採購執行
  Day 1:   評估供應商
  Day 2:   下達採購訂單
  Day 3-5: 等待交貨
  Day 6-7: 收貨檢驗

Week 3-4: 配送執行
  Day 1:   規劃配送路線
  Day 2-10: 執行配送
  Day 11-14: 收集反饋

供應鏈 KPI 儀表板:
──────────────────────────────────────
指標                  目標    實際    狀態
──────────────────────────────────────
預測準確率 (MAPE)      <5%    3.8%    ✅
庫存週轉率            >6次    6.8次   ✅
訂單履行率            >95%    97.2%   ✅
供應商準時率          >90%    92.0%   ✅
配送成本優化          -10%    -12.3%  ✅
庫存持有成本          <20%    18.5%   ✅
──────────────────────────────────────

成本節省分析:

優化前 (月度):
  庫存成本: $180,000
  配送成本: $25,000
  缺貨成本: $15,000
  總成本: $220,000

優化後 (月度):
  庫存成本: $148,000 (-18%)
  配送成本: $18,000 (-28%)
  缺貨成本: $5,000 (-67%)
  總成本: $171,000 (-22%)

年度節省: $588,000

投資回報率:
  系統實施成本: $200,000
  年度節省: $588,000
  ROI: 194%
  回本期: 4.1 個月

💡 最佳實踐:

1. 數據驅動決策
   • 收集完整歷史數據
   • 定期更新預測模型
   • 監控關鍵指標

2. 多方協作
   • 需求、採購、物流協同
   • 與供應商建立夥伴關係
   • 跨部門溝通

3. 持續優化
   • 定期檢討流程
   • 採用新技術和方法
   • 培訓團隊能力

4. 風險管理
   • 多元化供應商
   • 保持適當安全庫存
   • 建立應急計劃
    """)

def main():
    """主函數"""
    demo_route_optimization()
    demo_inventory_optimization()
    demo_supplier_performance()
    demo_demand_forecasting()
    demo_integrated_supply_chain()

    print("\n" + "🎉" * 40)
    print("供應鏈管理系統範例介紹完成！")
    print("🎉" * 40)

    print("""
📚 學習路徑建議:

基礎級:
   1. 理解供應鏈基本概念
   2. 學習庫存管理理論 (EOQ, ROP)
   3. 掌握基本的需求預測方法

中級:
   1. 深入路線優化算法 (TSP, VRP)
   2. 掌握 Prophet 時間序列預測
   3. 建立供應商評估體系

高級:
   1. 整合端到端供應鏈流程
   2. 開發自定義優化算法
   3. 建立供應鏈數字孿生

🎯 實踐建議:
   • 從單一模組開始試點
   • 收集高品質歷史數據
   • 根據業務特性調整參數
   • 定期驗證模型準確性
   • 建立跨部門協作機制

📖 理論基礎:
   • 運籌學 (Operations Research)
   • 庫存管理理論
   • 時間序列分析
   • 優化算法
   • 供應鏈管理

💻 技術工具:
   • Python: 核心開發語言
   • Prophet: 時間序列預測
   • NumPy/Pandas: 數據處理
   • Matplotlib: 可視化
   • Genetic Algorithm: 優化求解

🌐 進階主題:
   • 機器學習預測
   • 實時優化
   • 供應鏈數位化
   • 區塊鏈追溯
   • IoT 整合
    """)

if __name__ == '__main__':
    main()
