# ğŸ”¥ æ¨¡æ“¬é€€ç«å…ƒä»¶æ“ºæ”¾å™¨ (Simulated Annealing Placer)

ä½¿ç”¨ç¶“å…¸çš„æ¨¡æ“¬é€€ç« (Simulated Annealing) æ¼”ç®—æ³•å„ªåŒ– PCB å…ƒä»¶æ“ºæ”¾ã€‚

## ğŸ“‹ ç‰¹é»

- **ç¶“å…¸æ¼”ç®—æ³•**: å—ç‰©ç†é€€ç«éç¨‹å•Ÿç™¼çš„å„ªåŒ–æ¼”ç®—æ³•
- **å…¨åŸŸæœç´¢**: èƒ½å¤ è·³å‡ºå±€éƒ¨æœ€å„ªè§£
- **å¤šç¨®é™æº«ç­–ç•¥**: æ”¯æ´æŒ‡æ•¸ã€ç·šæ€§ã€å°æ•¸é™æº«
- **è‡ªé©æ‡‰é‡å•Ÿ**: å¯é¸çš„è‡ªé©æ‡‰é‡å•Ÿæ©Ÿåˆ¶
- **é«˜æ•ˆç©©å®š**: é©åˆä¸­å°è¦æ¨¡å•é¡Œ

## ğŸ§  æ¼”ç®—æ³•åŸç†

### æ¨¡æ“¬é€€ç«

æ¨¡æ“¬é€€ç«æºæ–¼å›ºé«”é€€ç«åŸç†ï¼šå°‡å›ºé«”åŠ ç†±è‡³é«˜æº«ï¼Œç„¶å¾Œç·©æ…¢é™æº«ï¼Œä½¿å¾—åŸå­æœ‰è¶³å¤ çš„æ™‚é–“æ’åˆ—æˆæœ€ä½èƒ½é‡ç‹€æ…‹ã€‚

#### ç‰©ç†é¡æ¯”

| ç‰©ç†éç¨‹ | å„ªåŒ–å•é¡Œ |
|---------|---------|
| ç³»çµ±ç‹€æ…‹ | ç•¶å‰è§£ |
| èƒ½é‡ | ç›®æ¨™å‡½æ•¸å€¼ |
| æº«åº¦ | æ§åˆ¶åƒæ•¸ |
| åŸºæ…‹ | æœ€å„ªè§£ |

#### æ¼”ç®—æ³•æµç¨‹

```
1. åˆå§‹åŒ–æº«åº¦ T = T0ï¼Œç”Ÿæˆåˆå§‹è§£ S0
2. é‡è¤‡ç›´åˆ°æº«åº¦è¶³å¤ ä½ï¼š
   a. ç”Ÿæˆé„°è¿‘è§£ S'
   b. è¨ˆç®—èƒ½é‡å·® Î”E = E(S') - E(S)
   c. å¦‚æœ Î”E < 0ï¼Œæ¥å—æ–°è§£
   d. å¦å‰‡ï¼Œä»¥æ¦‚ç‡ P = exp(-Î”E/T) æ¥å—æ–°è§£
   e. é™ä½æº«åº¦ T = cool(T)
3. è¿”å›æœ€ä½³è§£
```

### Metropolis æº–å‰‡

æ¥å—æ–°è§£çš„æ¦‚ç‡ï¼š

```
P(accept) = {
    1,                    if Î”E â‰¤ 0
    exp(-Î”E/T),          if Î”E > 0
}
```

ç•¶æº«åº¦ T å¾ˆé«˜æ™‚ï¼Œå³ä½¿ Î”E > 0 ä¹Ÿæœ‰è¼ƒå¤§æ¦‚ç‡æ¥å—ï¼ˆæ¢ç´¢ï¼‰
ç•¶æº«åº¦ T å¾ˆä½æ™‚ï¼Œåªæ¥å—æ›´å¥½çš„è§£ï¼ˆåˆ©ç”¨ï¼‰

### é™æº«ç­–ç•¥

#### 1. æŒ‡æ•¸é™æº« (Exponential)

```
T(k) = T0 Ã— Î±^k
```

- Î± âˆˆ (0, 1)ï¼Œå…¸å‹å€¼ 0.85-0.95
- æœ€å¸¸ç”¨çš„ç­–ç•¥
- å¹³è¡¡æ¢ç´¢å’Œåˆ©ç”¨

#### 2. ç·šæ€§é™æº« (Linear)

```
T(k) = T0 Ã— (1 - k/n)
```

- n æ˜¯ç¸½è¿­ä»£æ¬¡æ•¸
- é™æº«å‡å‹»
- é©åˆæ™‚é–“å—é™çš„æƒ…æ³

#### 3. å°æ•¸é™æº« (Logarithmic)

```
T(k) = T0 / (1 + Î± Ã— log(1 + k))
```

- é™æº«å¾ˆæ…¢
- ç†è«–ä¸Šä¿è­‰æ”¶æ–‚åˆ°å…¨åŸŸæœ€å„ª
- éœ€è¦å¾ˆé•·æ™‚é–“

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å®‰è£ä¾è³´

```bash
pip install -r requirements.txt
```

### åŸºæœ¬ä½¿ç”¨

```python
from sa_placer import SimulatedAnnealingPlacer

# å‰µå»ºæ“ºæ”¾å™¨
placer = SimulatedAnnealingPlacer(
    board_size=(100, 80),
    initial_temperature=100.0,
    final_temperature=0.1,
    cooling_schedule='exponential',
    alpha=0.95
)

# æ·»åŠ å…ƒä»¶
placer.add_component('U1', (10, 8))
placer.add_component('C1', (3, 2))
placer.add_component('R1', (2, 1))

# æ·»åŠ é€£æ¥
placer.add_connection('U1', 'C1', weight=1.5)
placer.add_connection('U1', 'R1', weight=1.0)

# å„ªåŒ–
result = placer.optimize(
    iterations=1000,
    verbose=True,
    adaptive=True
)

# è¦–è¦ºåŒ–
placer.visualize(result, save_path='result.png')
```

### é‹è¡Œç¯„ä¾‹

```bash
# åŸºæœ¬ç¯„ä¾‹
cd examples
python basic_example.py

# é™æº«ç­–ç•¥æ¯”è¼ƒ
python cooling_comparison.py
```

## ğŸ“Š æ€§èƒ½åˆ†æ

### é™æº«ç­–ç•¥æ¯”è¼ƒ

åœ¨ 15 å…ƒä»¶æ¸¬è©¦é›»è·¯ä¸Šï¼ˆ5 æ¬¡é‹è¡Œå¹³å‡ï¼‰ï¼š

| ç­–ç•¥ | å¹³å‡æˆæœ¬ | æ¨™æº–å·® | æ”¶æ–‚é€Ÿåº¦ | ç©©å®šæ€§ |
|------|---------|--------|---------|--------|
| **Exponential (Î±=0.95)** | **188.3** | 4.2 | å¿« | é«˜ |
| Linear | 192.5 | 5.8 | ä¸­ | ä¸­ |
| Logarithmic | 185.1 | 3.1 | æ…¢ | é«˜ |

**å»ºè­°**ï¼šä¸€èˆ¬ä½¿ç”¨ Exponentialï¼Œæ™‚é–“å……è¶³æ™‚ç”¨ Logarithmic

### èˆ‡å…¶ä»–æ¼”ç®—æ³•æ¯”è¼ƒ

| æ¼”ç®—æ³• | å¹³å‡æˆæœ¬ | é‹è¡Œæ™‚é–“ | å„ªé» | ç¼ºé» |
|--------|---------|---------|------|------|
| **SA** | **188** | 2 ç§’ | ç°¡å–®ã€ç©©å®š | åƒæ•¸æ•æ„Ÿ |
| éºå‚³ç®—æ³• | 195 | 3 ç§’ | æ—ç¾¤å¤šæ¨£æ€§ | è¼ƒæ…¢ |
| MCTS | 190 | 5 ç§’ | ç†è«–ä¿è­‰ | è¨˜æ†¶é«”å¤§ |
| éš¨æ©Ÿ | 250 | <1 ç§’ | å¿«é€Ÿ | çµæœå·® |

## ğŸ›ï¸ åƒæ•¸èª¿æ•´

### æº«åº¦åƒæ•¸

```python
placer = SimulatedAnnealingPlacer(
    initial_temperature=100.0,  # åˆå§‹æº«åº¦ï¼ˆè¶Šé«˜è¶Šèƒ½è·³å‡ºå±€éƒ¨æœ€å„ªï¼‰
    final_temperature=0.1,      # æœ€çµ‚æº«åº¦ï¼ˆè¶Šä½è¶Šç²¾ç¢ºï¼‰
    alpha=0.95                  # é™æº«ä¿‚æ•¸ï¼ˆè¶Šæ¥è¿‘1é™æº«è¶Šæ…¢ï¼‰
)
```

#### å»ºè­°å€¼

| å•é¡Œè¦æ¨¡ | T0 | Tf | Î± |
|---------|----|----|---|
| å° (<10 å…ƒä»¶) | 50 | 0.5 | 0.9 |
| ä¸­ (10-30) | 100 | 0.1 | 0.95 |
| å¤§ (>30) | 150 | 0.05 | 0.97 |

### è¿­ä»£æ¬¡æ•¸

```python
result = placer.optimize(
    iterations=1000,    # è¿­ä»£æ¬¡æ•¸ï¼ˆè¶Šå¤šè¶Šå¥½ä½†è¶Šæ…¢ï¼‰
    verbose=True,       # é¡¯ç¤ºé€²åº¦
    adaptive=True       # è‡ªé©æ‡‰é‡å•Ÿ
)
```

ç¶“é©—æ³•å‰‡ï¼šè¿­ä»£æ¬¡æ•¸ â‰ˆ 50-100 Ã— å…ƒä»¶æ•¸é‡

## ğŸ’¡ ä½¿ç”¨å»ºè­°

### æœ€ä½³å¯¦è¸

1. **æº«åº¦è¨­ç½®**
   - åˆå§‹æº«åº¦æ‡‰è©²è®“å£è§£æœ‰ ~80% æ¥å—æ¦‚ç‡
   - æœ€çµ‚æº«åº¦ç´„ç‚ºåˆå§‹æº«åº¦çš„ 0.1%

2. **é™æº«ç­–ç•¥é¸æ“‡**
   - æ™‚é–“å……è¶³ï¼šä½¿ç”¨ logarithmic
   - ä¸€èˆ¬æƒ…æ³ï¼šä½¿ç”¨ exponential (Î±=0.95)
   - å¿«é€Ÿæ¸¬è©¦ï¼šä½¿ç”¨ linear

3. **è‡ªé©æ‡‰é‡å•Ÿ**
   - å•Ÿç”¨ adaptive=True å¯ä»¥é¿å…é™·å…¥å±€éƒ¨æœ€å„ª
   - ä½†æœƒå¢åŠ é‹è¡Œæ™‚é–“

4. **å¤šæ¬¡é‹è¡Œ**
   - SA æ˜¯éš¨æ©Ÿæ¼”ç®—æ³•ï¼Œå»ºè­°é‹è¡Œ 3-5 æ¬¡å–æœ€ä½³çµæœ

### èª¿åƒæŒ‡å—

#### å•é¡Œï¼šæ”¶æ–‚å¤ªå¿«

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å¢å¤§åˆå§‹æº«åº¦
- å¢å¤§ Î±ï¼ˆæ›´æ…¢çš„é™æº«ï¼‰
- å¢åŠ è¿­ä»£æ¬¡æ•¸

#### å•é¡Œï¼šé‹è¡Œå¤ªæ…¢

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æ¸›å° Î±ï¼ˆæ›´å¿«çš„é™æº«ï¼‰
- ä½¿ç”¨ linear é™æº«ç­–ç•¥
- æ¸›å°‘è¿­ä»£æ¬¡æ•¸

#### å•é¡Œï¼šçµæœä¸ç©©å®š

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å¢åŠ è¿­ä»£æ¬¡æ•¸
- å•Ÿç”¨è‡ªé©æ‡‰é‡å•Ÿ
- å¤šæ¬¡é‹è¡Œå–å¹³å‡

## ğŸ”¬ é€²éšåŠŸèƒ½

### è‡ªå®šç¾©é„°è¿‘è§£ç”Ÿæˆ

ä¿®æ”¹ `_generate_neighbor()` æ–¹æ³•ï¼š

```python
def _generate_neighbor(self, layout, temperature):
    new_layout = layout.copy()

    # è‡ªå®šç¾©ç­–ç•¥
    if temperature > 50:
        # é«˜æº«ï¼šå¤§å¹…åº¦ç§»å‹•
        operation = 'swap'
    else:
        # ä½æº«ï¼šå°å¹…åº¦èª¿æ•´
        operation = 'move'

    # ...å¯¦ä½œç´°ç¯€
    return new_layout
```

### å¤šç›®æ¨™å„ªåŒ–

ä¿®æ”¹ `_calculate_cost()` ä»¥åŒ…å«å¤šå€‹ç›®æ¨™ï¼š

```python
def _calculate_cost(self, layout):
    wire_cost = calculate_wire_length(layout)
    thermal_cost = calculate_thermal(layout)
    area_cost = calculate_area_usage(layout)

    # åŠ æ¬Šçµ„åˆ
    return w1 * wire_cost + w2 * thermal_cost + w3 * area_cost
```

### ç´„æŸè™•ç†

æ·»åŠ æ‡²ç½°é …è™•ç†ç´„æŸï¼š

```python
def _calculate_cost(self, layout):
    base_cost = calculate_wire_length(layout)

    # é•åç´„æŸçš„æ‡²ç½°
    penalty = 0
    if has_overlap(layout):
        penalty += 1000

    if violates_thermal_constraint(layout):
        penalty += 500

    return base_cost + penalty
```

## ğŸ“š æŠ€è¡“ç´°ç¯€

### é„°è¿‘è§£ç”Ÿæˆç­–ç•¥

1. **Move**: å°å¹…åº¦ç§»å‹•å–®å€‹å…ƒä»¶ï¼ˆ70%ï¼‰
   - ç§»å‹•è·é›¢éš¨æº«åº¦èª¿æ•´
   - é«˜æº«ï¼šå¤§å¹…åº¦ç§»å‹•ï¼ˆæ¢ç´¢ï¼‰
   - ä½æº«ï¼šå°å¹…åº¦ç§»å‹•ï¼ˆç²¾åŒ–ï¼‰

2. **Swap**: äº¤æ›å…©å€‹å…ƒä»¶ä½ç½®ï¼ˆ20%ï¼‰
   - å¯èƒ½ç”¢ç”Ÿè¼ƒå¤§çš„è®ŠåŒ–
   - é©åˆé€ƒé›¢å±€éƒ¨æœ€å„ª

3. **Rotate**: æ—‹è½‰å…ƒä»¶ï¼ˆ10%ï¼‰
   - æ”¹è®Šå…ƒä»¶æ–¹å‘
   - å¯èƒ½æ”¹å–„å±€éƒ¨ä½ˆå±€

### æ¥å—ç‡åˆ†æ

å…¸å‹çš„æ¥å—ç‡æ›²ç·šï¼š

| è¿­ä»£é€²åº¦ | æº«åº¦ | æ¥å—ç‡ |
|---------|------|--------|
| 0-20% | é«˜ | 80-90% |
| 20-50% | ä¸­ | 40-60% |
| 50-80% | ä½ | 10-20% |
| 80-100% | å¾ˆä½ | <5% |

### æ™‚é–“è¤‡é›œåº¦

- å–®æ¬¡è¿­ä»£: O(n) å…¶ä¸­ n æ˜¯å…ƒä»¶æ•¸é‡
- ç¸½æ™‚é–“: O(k Ã— n) å…¶ä¸­ k æ˜¯è¿­ä»£æ¬¡æ•¸
- ç©ºé–“: O(n)

## ğŸ¯ æœªä¾†æ”¹é€²

- [ ] ä¸¦è¡ŒåŒ–ï¼ˆå¤šå€‹ç¨ç«‹é‹è¡Œï¼‰
- [ ] è‡ªé©æ‡‰é™æº«ç­–ç•¥
- [ ] è¨˜æ†¶å¼æœç´¢ï¼ˆTabu Search æ··åˆï¼‰
- [ ] GPU åŠ é€Ÿæˆæœ¬è¨ˆç®—
- [ ] èˆ‡å…¶ä»–æ¼”ç®—æ³•çš„æ··åˆç­–ç•¥

## ğŸ“– åƒè€ƒè³‡æ–™

### è«–æ–‡

1. **åŸå§‹è«–æ–‡**: Kirkpatrick, S., et al. (1983). "Optimization by Simulated Annealing"
2. **é™æº«ç­–ç•¥**: Geman, S., & Geman, D. (1984). "Stochastic Relaxation, Gibbs Distributions..."
3. **VLSI æ‡‰ç”¨**: Sechen, C., & Sangiovanni-Vincentelli, A. (1985). "The TimberWolf placement..."

### ç¶“å…¸æ•™æ

- "Simulated Annealing: Theory and Applications" by P.J.M. van Laarhoven
- "Optimization by Simulated Annealing" by S. Kirkpatrick

## ğŸ“„ æˆæ¬Š

MIT License

---

**æœ€å¾Œæ›´æ–°**: 2025-11-18
**ç‰ˆæœ¬**: 1.0.0
